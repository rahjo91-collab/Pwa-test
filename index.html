<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Family Dashboard - Shared chores and todo list">
    <meta name="theme-color" content="#4285f4">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Family">
    <meta name="mobile-web-app-capable" content="yes">

    <link rel="manifest" href="./manifest.json">
    <link rel="icon" type="image/png" href="./icon-192x192.png">
    <link rel="apple-touch-icon" href="./icon-192x192.png">
    <link rel="stylesheet" href="./styles.css">

    <title>Family Dashboard</title>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1>Family Dashboard</h1>
                <p class="version" id="app-version">v0.0.0</p>
            </div>
            <button id="install-btn" class="install-btn" style="display: none;">Install App</button>
        </header>

        <!-- Tab Navigation -->
        <nav class="tab-nav">
            <button class="tab-btn active" data-view="dashboard">
                <span class="tab-icon">&#127968;</span>
                <span class="tab-label">Dashboard</span>
            </button>
            <button class="tab-btn" data-view="chores">
                <span class="tab-icon">&#9745;</span>
                <span class="tab-label">Chores</span>
            </button>
            <button class="tab-btn" data-view="family">
                <span class="tab-icon">&#128106;</span>
                <span class="tab-label">Family</span>
            </button>
            <button class="tab-btn" data-view="dev">
                <span class="tab-icon">&#128295;</span>
                <span class="tab-label">Dev</span>
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- ===== Dashboard View ===== -->
            <div id="view-dashboard" class="view active">
                <div class="summary-cards">
                    <div class="summary-card summary-today">
                        <div class="summary-number" id="stat-today">0</div>
                        <div class="summary-label">Due Today</div>
                    </div>
                    <div class="summary-card summary-overdue">
                        <div class="summary-number" id="stat-overdue">0</div>
                        <div class="summary-label">Overdue</div>
                    </div>
                    <div class="summary-card summary-done">
                        <div class="summary-number" id="stat-done-today">0</div>
                        <div class="summary-label">Done Today</div>
                    </div>
                    <div class="summary-card summary-streak">
                        <div class="summary-number" id="stat-streak">0</div>
                        <div class="summary-label">Best Streak</div>
                    </div>
                </div>

                <section class="dashboard-section" id="section-overdue" style="display:none;">
                    <h3 class="section-title section-title-overdue">Overdue</h3>
                    <div id="dashboard-overdue" class="chore-cards"></div>
                </section>

                <section class="dashboard-section" id="section-today">
                    <h3 class="section-title">Today's Chores</h3>
                    <div id="dashboard-today" class="chore-cards"></div>
                    <p id="today-empty" class="empty-hint" style="display:none;">Nothing due today. Enjoy your day!</p>
                </section>

                <section class="dashboard-section" id="section-upcoming">
                    <h3 class="section-title">Coming Up (Next 7 Days)</h3>
                    <div id="dashboard-upcoming" class="chore-cards"></div>
                    <p id="upcoming-empty" class="empty-hint" style="display:none;">No upcoming chores this week.</p>
                </section>

                <section class="dashboard-section" id="section-leaderboard">
                    <h3 class="section-title">Family Leaderboard (This Week)</h3>
                    <div id="dashboard-leaderboard" class="leaderboard"></div>
                    <p id="leaderboard-empty" class="empty-hint" style="display:none;">Add family members and complete chores to see the leaderboard.</p>
                </section>
            </div>

            <!-- ===== Chores View ===== -->
            <div id="view-chores" class="view">
                <div class="chores-header">
                    <div class="chores-filters">
                        <select id="filter-status" class="filter-select">
                            <option value="all">All Active</option>
                            <option value="today">Due Today</option>
                            <option value="overdue">Overdue</option>
                            <option value="upcoming">Upcoming (7 days)</option>
                            <option value="grace">In Grace Period</option>
                            <option value="paused">Paused</option>
                        </select>
                        <select id="filter-member" class="filter-select">
                            <option value="all">All Members</option>
                        </select>
                        <select id="filter-category" class="filter-select">
                            <option value="all">All Categories</option>
                            <option value="kitchen">Kitchen</option>
                            <option value="bathroom">Bathroom</option>
                            <option value="bedroom">Bedroom</option>
                            <option value="living_room">Living Room</option>
                            <option value="garden">Garden</option>
                            <option value="laundry">Laundry</option>
                            <option value="shopping">Shopping</option>
                            <option value="pets">Pets</option>
                            <option value="general">General</option>
                            <option value="other">Other</option>
                        </select>
                        <select id="filter-priority" class="filter-select">
                            <option value="all">All Priorities</option>
                            <option value="critical">Critical</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                </div>
                <div id="chores-list" class="chore-cards"></div>
                <div id="chores-empty" class="empty-state" style="display: none;">
                    <p>No chores match your filters. Try changing filters or add a new chore.</p>
                </div>
            </div>

            <!-- ===== Family View ===== -->
            <div id="view-family" class="view">
                <div class="family-header">
                    <h3>Family Members</h3>
                    <button id="btn-add-member" class="btn-primary btn-sm">+ Add Member</button>
                </div>
                <div id="family-list" class="family-grid"></div>
                <div id="family-empty" class="empty-state" style="display: none;">
                    <p>No family members yet. Add your first family member to get started!</p>
                </div>
            </div>
            <!-- ===== Dev View ===== -->
            <div id="view-dev" class="view">
                <div class="dev-header">
                    <h3>Developer Tools</h3>
                    <span class="dev-badge">DEV MODE</span>
                </div>

                <div id="dev-log" class="dev-log">
                    <div class="dev-log-header">
                        <span>Log Output</span>
                        <button class="btn-sm btn-secondary" onclick="devClearLog()">Clear</button>
                    </div>
                    <div id="dev-log-content" class="dev-log-content">Ready.</div>
                </div>

                <!-- DB Stats -->
                <div class="dev-section">
                    <h4 class="dev-section-title">Database Stats</h4>
                    <div id="dev-stats" class="dev-stats"></div>
                    <button class="dev-btn" onclick="devRefreshStats()">Refresh Stats</button>
                </div>

                <!-- Quick Setup -->
                <div class="dev-section">
                    <h4 class="dev-section-title">Quick Setup</h4>
                    <p class="dev-desc">Seed sample data to quickly populate the app for testing.</p>
                    <div class="dev-btn-grid">
                        <button class="dev-btn dev-btn-blue" onclick="devSeedFamily()">Seed Sample Family (4 members)</button>
                        <button class="dev-btn dev-btn-blue" onclick="devSeedChores()">Seed Sample Chores (~15 chores)</button>
                        <button class="dev-btn dev-btn-blue" onclick="devSeedAll()">Seed Everything (Family + Chores)</button>
                    </div>
                </div>

                <!-- Bulk Chore Generation -->
                <div class="dev-section">
                    <h4 class="dev-section-title">Bulk Chore Generator</h4>
                    <p class="dev-desc">Quickly generate lots of chores with random settings to stress-test the UI.</p>
                    <div class="dev-btn-grid">
                        <button class="dev-btn dev-btn-green" onclick="devAddRandomChores(5)">+ 5 Random Chores</button>
                        <button class="dev-btn dev-btn-green" onclick="devAddRandomChores(15)">+ 15 Random Chores</button>
                        <button class="dev-btn dev-btn-green" onclick="devAddRandomChores(50)">+ 50 Random Chores</button>
                    </div>
                    <div class="dev-btn-grid" style="margin-top:8px;">
                        <button class="dev-btn dev-btn-green" onclick="devAddOverdueChores(5)">+ 5 Overdue Chores</button>
                        <button class="dev-btn dev-btn-green" onclick="devAddTodayChores(5)">+ 5 Due-Today Chores</button>
                        <button class="dev-btn dev-btn-green" onclick="devAddGracePeriodChores(5)">+ 5 In-Grace-Period</button>
                    </div>
                </div>

                <!-- Simulate Activity -->
                <div class="dev-section">
                    <h4 class="dev-section-title">Simulate Activity</h4>
                    <p class="dev-desc">Create fake completion history and test the leaderboard/stats.</p>
                    <div class="dev-btn-grid">
                        <button class="dev-btn dev-btn-purple" onclick="devSimulateCompletions(10)">Simulate 10 Completions</button>
                        <button class="dev-btn dev-btn-purple" onclick="devSimulateCompletions(50)">Simulate 50 Completions</button>
                        <button class="dev-btn dev-btn-purple" onclick="devCompleteAllToday()">Complete All Due Today</button>
                        <button class="dev-btn dev-btn-purple" onclick="devPostponeAllToday()">Postpone All Due Today</button>
                    </div>
                </div>

                <!-- Notifications -->
                <div class="dev-section">
                    <h4 class="dev-section-title">Notifications</h4>
                    <p class="dev-desc">Test notifications. You must grant permission first.</p>
                    <div id="dev-notif-status" class="dev-notif-status"></div>
                    <div class="dev-btn-grid">
                        <button class="dev-btn dev-btn-orange" onclick="devRequestNotifPermission()">Request Permission</button>
                        <button class="dev-btn dev-btn-orange" onclick="devFireBasicNotif()">Fire Basic Notification</button>
                        <button class="dev-btn dev-btn-orange" onclick="devFireChoreReminder()">Fire Chore Reminder</button>
                        <button class="dev-btn dev-btn-orange" onclick="devFireOverdueAlert()">Fire Overdue Alert</button>
                        <button class="dev-btn dev-btn-orange" onclick="devFireSWNotif()">Fire via Service Worker</button>
                    </div>
                    <!-- Custom notification -->
                    <div class="dev-custom-notif">
                        <h5>Custom Notification</h5>
                        <div class="form-group">
                            <input type="text" id="dev-notif-title" placeholder="Title" value="Family Dashboard">
                        </div>
                        <div class="form-group">
                            <input type="text" id="dev-notif-body" placeholder="Body" value="Time to do your chores!">
                        </div>
                        <div class="form-group">
                            <select id="dev-notif-tag">
                                <option value="test">Tag: test</option>
                                <option value="chore-reminder">Tag: chore-reminder</option>
                                <option value="overdue-alert">Tag: overdue-alert</option>
                                <option value="weekly-summary">Tag: weekly-summary</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="dev-notif-require-interaction">
                                    <span>Require Interaction</span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="dev-notif-vibrate" checked>
                                    <span>Vibrate</span>
                                </label>
                            </div>
                        </div>
                        <button class="dev-btn dev-btn-orange" onclick="devFireCustomNotif()">Fire Custom Notification</button>
                        <button class="dev-btn dev-btn-orange" onclick="devFireCustomViaSW()">Fire Custom via SW</button>
                    </div>

                    <!-- Notification burst -->
                    <div class="dev-btn-grid" style="margin-top: 12px;">
                        <button class="dev-btn dev-btn-orange" onclick="devFireNotifBurst(3)">Fire 3 Rapid Notifications</button>
                        <button class="dev-btn dev-btn-orange" onclick="devFireNotifBurst(10)">Fire 10 Rapid Notifications</button>
                    </div>
                </div>

                <!-- Data Management -->
                <div class="dev-section">
                    <h4 class="dev-section-title dev-section-title-danger">Data Management</h4>
                    <p class="dev-desc">Clear data from the database. These actions cannot be undone.</p>
                    <div class="dev-btn-grid">
                        <button class="dev-btn dev-btn-red" onclick="devClearChores()">Clear All Chores</button>
                        <button class="dev-btn dev-btn-red" onclick="devClearCompletions()">Clear All Completions</button>
                        <button class="dev-btn dev-btn-red" onclick="devClearFamily()">Clear All Family Members</button>
                        <button class="dev-btn dev-btn-red" onclick="devNuclearReset()">Nuclear Reset (Everything)</button>
                    </div>
                    <div class="dev-btn-grid" style="margin-top:8px;">
                        <button class="dev-btn" onclick="devExportJSON()">Export All Data as JSON</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Floating Action Button -->
        <button id="fab-add" class="fab" title="Add New Chore">+</button>

        <!-- ===== Chore Create/Edit Modal ===== -->
        <div id="chore-modal" class="modal-overlay" style="display:none;">
            <div class="modal">
                <div class="modal-header">
                    <h2 id="chore-modal-title">New Chore</h2>
                    <button class="modal-close" id="chore-modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="chore-form">
                        <input type="hidden" id="chore-id">

                        <!-- Basic Info -->
                        <div class="form-section">
                            <h4 class="form-section-title">Basic Info</h4>
                            <div class="form-group">
                                <label for="chore-title">Title *</label>
                                <input type="text" id="chore-title" required placeholder="e.g., Wash dishes, Take out bins">
                            </div>
                            <div class="form-group">
                                <label for="chore-description">Description</label>
                                <textarea id="chore-description" rows="2" placeholder="Optional details or instructions..."></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="chore-category">Category</label>
                                    <select id="chore-category">
                                        <option value="general">General</option>
                                        <option value="kitchen">Kitchen</option>
                                        <option value="bathroom">Bathroom</option>
                                        <option value="bedroom">Bedroom</option>
                                        <option value="living_room">Living Room</option>
                                        <option value="garden">Garden</option>
                                        <option value="laundry">Laundry</option>
                                        <option value="shopping">Shopping</option>
                                        <option value="pets">Pets</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="chore-priority">Priority</label>
                                    <select id="chore-priority">
                                        <option value="low">Low</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="high">High</option>
                                        <option value="critical">Critical</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Assignment -->
                        <div class="form-section">
                            <h4 class="form-section-title">Assignment</h4>
                            <div class="form-group">
                                <label for="chore-assigned">Assigned To</label>
                                <select id="chore-assigned">
                                    <option value="">Anyone</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="chore-rotation">
                                    <span>Enable rotation between family members</span>
                                </label>
                                <span class="form-hint">Automatically rotate who does this chore each time</span>
                            </div>
                            <div id="rotation-members-group" class="form-group" style="display: none;">
                                <label>Rotation Members</label>
                                <div id="rotation-members-list" class="checkbox-group"></div>
                            </div>
                        </div>

                        <!-- Schedule -->
                        <div class="form-section">
                            <h4 class="form-section-title">Schedule</h4>
                            <div class="form-group">
                                <label for="chore-frequency">Frequency</label>
                                <select id="chore-frequency">
                                    <option value="daily">Daily</option>
                                    <option value="every_x_days">Every X Days</option>
                                    <option value="weekly">Weekly (pick days)</option>
                                    <option value="biweekly">Biweekly</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="once">One Time Only</option>
                                </select>
                            </div>
                            <div id="frequency-interval-group" class="form-group" style="display: none;">
                                <label for="chore-interval">Every how many days?</label>
                                <input type="number" id="chore-interval" min="2" max="365" value="3">
                            </div>
                            <div id="frequency-weekly-group" class="form-group" style="display: none;">
                                <label>Which days of the week?</label>
                                <div class="day-picker">
                                    <label class="day-chip"><input type="checkbox" name="weekday" value="0"><span>Sun</span></label>
                                    <label class="day-chip"><input type="checkbox" name="weekday" value="1" checked><span>Mon</span></label>
                                    <label class="day-chip"><input type="checkbox" name="weekday" value="2"><span>Tue</span></label>
                                    <label class="day-chip"><input type="checkbox" name="weekday" value="3"><span>Wed</span></label>
                                    <label class="day-chip"><input type="checkbox" name="weekday" value="4"><span>Thu</span></label>
                                    <label class="day-chip"><input type="checkbox" name="weekday" value="5"><span>Fri</span></label>
                                    <label class="day-chip"><input type="checkbox" name="weekday" value="6"><span>Sat</span></label>
                                </div>
                            </div>
                            <div id="frequency-monthly-group" class="form-group" style="display: none;">
                                <label for="chore-monthly-day">Day of the month</label>
                                <input type="number" id="chore-monthly-day" min="1" max="31" value="1">
                            </div>
                            <div class="form-group">
                                <label for="chore-start-date">Start Date</label>
                                <input type="date" id="chore-start-date">
                            </div>
                            <div class="form-group">
                                <label for="chore-preferred-time">Preferred Time of Day</label>
                                <select id="chore-preferred-time">
                                    <option value="anytime">Anytime</option>
                                    <option value="morning">Morning (before 12pm)</option>
                                    <option value="afternoon">Afternoon (12pm - 5pm)</option>
                                    <option value="evening">Evening (after 5pm)</option>
                                </select>
                            </div>
                        </div>

                        <!-- Flexibility & Slack -->
                        <div class="form-section">
                            <h4 class="form-section-title">Flexibility & Slack</h4>
                            <div class="form-group">
                                <label for="chore-slack">Grace Period (days)</label>
                                <input type="number" id="chore-slack" min="0" max="30" value="1">
                                <span class="form-hint">How many days past due date is still OK before it's considered overdue</span>
                            </div>
                            <div class="form-group">
                                <label for="chore-max-postpones">Max Consecutive Postpones</label>
                                <input type="number" id="chore-max-postpones" min="-1" max="99" value="3">
                                <span class="form-hint">Use -1 for unlimited, 0 to disable postponing entirely</span>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="chore-auto-reschedule" checked>
                                    <span>Auto-reschedule when postponed</span>
                                </label>
                                <span class="form-hint">Pushes the due date forward by 1 day each time the chore is postponed</span>
                            </div>
                            <div class="form-group">
                                <label for="chore-snooze-days">Postpone Duration (days)</label>
                                <input type="number" id="chore-snooze-days" min="1" max="14" value="1">
                                <span class="form-hint">How many days to push forward when postponing</span>
                            </div>
                        </div>

                        <!-- Effort & Rewards -->
                        <div class="form-section">
                            <h4 class="form-section-title">Effort & Rewards</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="chore-effort">Effort Level</label>
                                    <select id="chore-effort">
                                        <option value="quick">Quick (&lt; 15 min)</option>
                                        <option value="medium" selected>Medium (15-45 min)</option>
                                        <option value="long">Long (45+ min)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="chore-points">Points Reward</label>
                                    <input type="number" id="chore-points" min="0" max="1000" value="10">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="chore-bonus-early">
                                    <span>Bonus points for early completion</span>
                                </label>
                                <span class="form-hint">Awards 50% extra points if completed before due date</span>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="chore-streak-bonus" checked>
                                    <span>Streak bonus</span>
                                </label>
                                <span class="form-hint">Awards +1 extra point per consecutive on-time completion</span>
                            </div>
                        </div>

                        <!-- Notes -->
                        <div class="form-section">
                            <div class="form-group">
                                <label for="chore-notes">Notes</label>
                                <textarea id="chore-notes" rows="2" placeholder="Any additional notes, tips, or reminders..."></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" id="chore-delete-btn" class="btn-danger" style="display:none;">Delete</button>
                    <div class="modal-footer-right">
                        <button type="button" id="chore-modal-cancel" class="btn-secondary">Cancel</button>
                        <button type="button" id="chore-modal-save" class="btn-primary">Save Chore</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== Family Member Modal ===== -->
        <div id="family-modal" class="modal-overlay" style="display:none;">
            <div class="modal modal-sm">
                <div class="modal-header">
                    <h2 id="family-modal-title">Add Family Member</h2>
                    <button class="modal-close" id="family-modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="family-form">
                        <input type="hidden" id="member-id">
                        <div class="form-group">
                            <label for="member-name">Name *</label>
                            <input type="text" id="member-name" required placeholder="e.g., Mum, Dad, Alex">
                        </div>
                        <div class="form-group">
                            <label>Avatar</label>
                            <div class="avatar-picker" id="avatar-picker"></div>
                        </div>
                        <div class="form-group">
                            <label>Colour</label>
                            <div class="color-picker" id="color-picker"></div>
                        </div>
                        <div class="form-group">
                            <label for="member-role">Role</label>
                            <select id="member-role">
                                <option value="parent">Parent</option>
                                <option value="child">Child</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" id="family-delete-btn" class="btn-danger" style="display:none;">Delete</button>
                    <div class="modal-footer-right">
                        <button type="button" id="family-modal-cancel" class="btn-secondary">Cancel</button>
                        <button type="button" id="family-modal-save" class="btn-primary">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== Complete Chore Modal ===== -->
        <div id="complete-modal" class="modal-overlay" style="display:none;">
            <div class="modal modal-sm">
                <div class="modal-header">
                    <h2>Complete Chore</h2>
                    <button class="modal-close" id="complete-modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <p id="complete-chore-title" class="complete-chore-name"></p>
                    <div class="form-group">
                        <label for="complete-member">Completed by</label>
                        <select id="complete-member"></select>
                    </div>
                    <div class="form-group">
                        <label for="complete-notes">Notes (optional)</label>
                        <input type="text" id="complete-notes" placeholder="Any notes about this completion...">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="complete-modal-cancel" class="btn-secondary">Cancel</button>
                    <button type="button" id="complete-modal-save" class="btn-primary">Mark Complete</button>
                </div>
            </div>
        </div>

        <!-- ===== Chore Detail Modal ===== -->
        <div id="detail-modal" class="modal-overlay" style="display:none;">
            <div class="modal">
                <div class="modal-header">
                    <h2 id="detail-modal-title">Chore Details</h2>
                    <button class="modal-close" id="detail-modal-close">&times;</button>
                </div>
                <div class="modal-body" id="detail-modal-body"></div>
                <div class="modal-footer">
                    <button type="button" id="detail-modal-edit" class="btn-secondary">Edit</button>
                    <button type="button" id="detail-modal-ok" class="btn-primary">Close</button>
                </div>
            </div>
        </div>

        <footer>
            <p>&copy; 2026 Family Dashboard</p>
        </footer>
    </div>

    <script src="./version.js"></script>
    <script src="./app.js"></script>
</body>
</html>
